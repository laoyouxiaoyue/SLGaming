syntax = "proto3";

package agent;

option go_package = "./agent";

// 对话 Agent 服务
service Agent {
  // 健康检查
  rpc Ping(PingRequest) returns (PingResponse);

  // 发送用户消息，返回 Agent 回复
  rpc SendMessage(SendMessageRequest) returns (SendMessageResponse);

  // 获取会话列表
  rpc GetSessionList(GetSessionListRequest) returns (GetSessionListResponse);

  // 获取会话消息历史
  rpc GetMessageHistory(GetMessageHistoryRequest) returns (GetMessageHistoryResponse);
}

// 健康检查
message PingRequest {}

message PingResponse {
  string message = 1; // 返回 "pong" 或自定义信息
}

// 发送消息请求
message SendMessageRequest {
  string session_id = 1;  // 会话 ID，客户端可复用；为空则服务端可生成
  uint64 user_id    = 2;  // 业务用户 ID（用于权限/画像）
  string content    = 3;  // 用户输入内容
  map<string, string> metadata = 4; // 额外元数据（可选）
}

// 发送消息响应
message SendMessageResponse {
  string session_id = 1; // 确认会话 ID（如果服务端生成）
  string answer     = 2; // Agent 的回复
}

// 获取会话列表请求
message GetSessionListRequest {
  uint64 user_id = 1;     // 用户 ID
  int32  page    = 2;     // 页码，从1开始
  int32  page_size = 3;   // 每页数量，默认20
}

// 会话信息
message SessionInfo {
  string session_id = 1;  // 会话 ID
  string title      = 2;  // 会话标题（通常是第一条消息的摘要）
  int64  created_at = 3;  // 创建时间戳（Unix时间戳，秒）
  int64  updated_at = 4;  // 更新时间戳（Unix时间戳，秒）
  int32  message_count = 5; // 消息数量
}

// 获取会话列表响应
message GetSessionListResponse {
  repeated SessionInfo sessions = 1; // 会话列表
  int32 total = 2;                  // 总会话数
  int32 page = 3;                   // 当前页码
  int32 page_size = 4;             // 每页数量
}

// 获取消息历史请求
message GetMessageHistoryRequest {
  string session_id = 1;  // 会话 ID
  uint64 user_id    = 2;  // 用户 ID（用于权限验证）
  int32  page       = 3;  // 页码，从1开始（可选，用于分页加载）
  int32  page_size  = 4;  // 每页数量，默认50（可选）
}

// 消息信息
message MessageInfo {
  int64  id         = 1;  // 消息 ID
  string role       = 2;  // 角色："user" 或 "assistant"
  string content    = 3;  // 消息内容
  int64  created_at = 4;  // 创建时间戳（Unix时间戳，秒）
}

// 获取消息历史响应
message GetMessageHistoryResponse {
  string session_id = 1;           // 会话 ID
  repeated MessageInfo messages = 2; // 消息列表（按时间正序）
  int32 total = 3;                 // 总消息数
  int32 page = 4;                  // 当前页码
  int32 page_size = 5;            // 每页数量
}

